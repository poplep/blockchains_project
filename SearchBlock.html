<!DOCTYPE html>
<html>
<title>Blockchain UI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Importing Fonts and Libraries -->
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Pavanam" rel="stylesheet">


<!-- Style for the tile buttons -->
<style>
	div.gallery {
		margin: 5px;
		border: 1px solid #ccc;
		float: left;
		width: 300px;
	}
	
	div.gallery:hover {
		border: 1px solid #777;
	}
	
	div.gallery img {
		width: 100%;
		height: auto;
	}
	
	div.desc {
		padding: 15px;
		text-align: center;
	}
	</style>

<!-- Overall Page Styling -->
<!-- Styling for blocks -->
<style>
	.block {
		width: 350px;
		height: 350px;
		padding: 10px;
		float:left;
		border: 2px solid rgb(49, 57, 77);
		border-radius: 10px;
		background-color:rgb(49, 57, 77);
		font-family: 'Pavanam', sans-serif;
		color: black;
		margin:10px;

	}

</style>
<style>
	p,h1,h2,h3,h4,h5,body {font-family: 'Pavanam', sans-serif;}
	p,h5, pre {font-size: 22px; font-family: 'Pavanam', sans-serif;};
	a {font-size: 15px; font-family: 'Pavanam', sans-serif;};
		.under { text-decoration: underline rgb(0, 0, 0);}
		input[type=text], select {
			width: 50%;
			padding: 12px 20px;
			margin: 8px 0;
			display: inline-block;
			border: 1px solid #ccc;
			border-radius: 4px;
			box-sizing: border-box;
		}
			
		input[type=data], select {
			width: 50%;
			height: 150px;
			padding: 12px 20px;
			margin: 8px 0;
			display: inline-block;
			border: 1px solid #ccc;
			border-radius: 4px;	
		}
	
		input[type=submit] {
			width: 50%;
			background-color: rgb(49, 57, 77);
			color: white;
			padding: 14px 20px;
			margin: 8px 0;
			border: none;
			border-radius: 4px;
			cursor: pointer;
		}
	
		input[type=submit]:hover {
			background-color: rgb(49, 57, 77);
		}
		.button {
			background-color: rgb(49, 57, 77); 
			border: none;
			color: white;
			padding: 15px 32px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			margin: 4px 2px;
			cursor: pointer;
		}
		.button1 {font-size: 24px;}
			
		.w3-container {
			background-color:rgb(49, 57, 77);
		}
		.w3-sidebar {
			background-color:rgb(49, 57, 77);
		}
		pre {
			word-wrap: break-word;
		}
		.w3-bar-item {
			padding: 20px;
			margin: -5px;
		}
</style>
<head></head>
<body>
<!-- Sidebar/menu -->
<div position = "absolute">
	<nav class="w3-sidebar w3-collapse" style="z-index:3; width: 12%" id="mySidebar"><br>
		<div class="w3-bar-block">
			<a href="HomePage.html" style="color: white; font-size: 26px"><h5><button class="w3-bar-item w3-button tablink">Home</button></h5></a>

			<div><h5 class="w3-bar-block" style="color: white; font-size: 26px">&nbsp;Blockchains</h5></div>
			<a href="Blockchain.html" style="color: white"><button class="w3-bar-item w3-button tablink"> About</button></a>
			<a href="BlockchainFAQ.html" style="color: white"><button class="w3-bar-item w3-button tablink"> FAQ</button></a>
			<a href="BlockchainAbout.html" style="color: white"><button class="w3-bar-item w3-button tablink"> About our Application </button></a>
			<a href="Guide.html" style="color: white"><button class="w3-bar-item w3-button tablink"> A Guide to Blockchain</button></a>
			<a href="BlockchainDataLossTampering.html" style="color: white"><button class="w3-bar-item w3-button tablink "> Blockchains for Preventing Data Loss and Tampering</button></a>

			<div><b><h5 class="w3-bar-block" style="color: white; font-size: 20px">&nbsp;Blockchain Functionality</h5></b></div>
			<a href="AddBlock.html" style="color: white"><button class="w3-bar-item w3-button tablink"> Add Block</button></a>
			<a href="SearchBlock.html" style="color: white"><button class="w3-bar-item w3-button tablink" > Search for a Block</button></a>
			<a href="ViewBlockAdvanced.html" style="color: white"><button class="w3-bar-item w3-button tablink"> View the Blockchain - Advanced</button></a>
			<a href="ViewBlockLedger.html" style="color: white"><button class="w3-bar-item w3-button tablink"> View the Blockchain - Ledger</button></a>
			<a href="BlockStats.html" style="color: white"><button class="w3-bar-item w3-button tablink"> Blockchain Statistics</button></a>

	
			<div><h5 class="w3-bar-block" style="color: white; font-size: 26px">&nbsp;Blockchain Alternatives</h5></div>
			<a href="HashgraphAbout.html" style="color: white"><button class="w3-bar-item w3-button tablink"> Hashgraph </button></a>
			<a href="TangleAbout.html" style="color: white"><button class="w3-bar-item w3-button tablink"> Tangle </button></a>
			<a href="HyperledgerAbout.html" style="color: white"><button class="w3-bar-item w3-button tablink"> Hyperledger </button></a>
			<a href="CordaAbout.html" style="color: white"><button class="w3-bar-item w3-button tablink"> Corda </button></a>
			<a href="DCSFAQ.html" style="color: white"><button class="w3-bar-item w3-button tablink"> FAQ </button></a>
			<a href="DCSDataLossTampering.html" style="color: white"><button class="w3-bar-item w3-button tablink"> Preventing Data Loss and Tampering</button></a>
			<a href="Comparison.html" style="color: white"><button class="w3-bar-item w3-button tablink"> Comparing Blockchain, Hyperledger, Corda, Tangle, and Hashgraph</button></a>

			<div><h5 class="w3-bar-block" style="color: white; font-size: 26px">&nbsp;Help Section</h5></div>
			<a href="Help.html" style="color: white"><button class="w3-bar-item w3-button tablink"> Help</button></a>
			<a href="ReportBug.html"style="color: white" ><button class="w3-bar-item w3-button tablink"> Report a Bug</button></a>
			<a href="Tutorial.html"style="color: white" ><button class="w3-bar-item w3-button tablink"> App Tutorial</button></a><br><br>
		</div>
	  </nav>
	  </div>
<!Each Page>
<div style="margin-left:13%" style="width:100vw" position ="fixed" >
	
		<div class="w3-container" style= "margin-left:-1.5%" color= "rgb(49, 57, 77)">
			<h1 style="color: white">Search for a Block</h1>
		</div>
		<br>
		<form id='form-prompt'>
				<a href="#" data-toggle="tooltip" data-placement="right" title="The name that you entered into the block." style="font-size:18px" style="color: black">Enter Name:</a><br>
            <input type='text' id="nameTest">
				<input type="submit" id="button1"/><br>
				<a href="#" data-toggle="tooltip" data-placement="right" title="The id that you entered into the block." style="font-size:18px" style="color: black">Enter ID:</a><br>
			<input type='text' id="idTest">
				<input type="submit" id="button2"/><br>
				<a href="#" data-toggle="tooltip" data-placement="right" title="The age that you entered into the block." style="font-size:18px" style="color: black">Enter Age:</a><br>
			<input type='text' id="ageTest">
        <input type="submit" id="button3"/>
			</form>
			
           
		<p>Once you add the block, it will be displayed below:</p>
		<div class="block"  id="duplicater0">	
			<a href="#" style="color:white" data-toggle="tooltip" data-placement="right" title="The person's name." style="font-size:18px" style="color: white">Name:</a><br>
			<pre id="name0"></pre><br>

			<a href="#" style="color:white" data-toggle="tooltip" data-placement="right" title="The person's ID number." style="font-size:18px" style="color: white">ID:</a><br>
			<pre id="id0"></pre><br>

			<a href="#" style="color:white" data-toggle="tooltip" data-placement="right" title="The person's age." style="font-size:18px" style="color: white">Age:</a><br>
			<pre id="age0" type="text"></pre><br>
			</div>

</div>

<script>
		$(document).ready(function(){
				$('[data-toggle="tooltip"]').tooltip();   
		});
		</script>
<!-- Search History -->
<script>

    var store = {

		keyCount:0,
		commandCount:0,
		prevCommand:[],
		put : function(val) {        
			this.commandCount++;
			this.keyCount = this.commandCount;
			this.prevCommand.push(val);        
		},
		get : function() {
			this.keyCount--;
			if(typeof this.prevCommand[this.keyCount] !== "undefined") {
				return this.prevCommand[this.keyCount];
			}    
		}    

	}

$("#form-prompt").on("submit", function (e) {
	store.put($('#textTest').val())
	e.preventDefault();
    $('#textTest').val('');	
});

$(document).keydown(function(event){
	if(event.which == 38 && $("#textTest").is(":focus")){
         var val = store.get();
		 val && $('#res').append('<hr>'+val);
	}else if(event.which == 40 && $("#command-text").is(":focus")) {

	}
});
</script>

<!-- Search Functionality (from view block)-->

<script>
	
	var web3 =  new Web3(web3.currentProvider); //provider for web3

	//remove special characters from the name so it can be displayed properly to the user
	function removeSpecialChars(strVal){
		strVal = strVal.replace(/[^a-z\d\s]+/gi, "");
		return strVal;
	}
//contract abi, pass json representation of contract to instance
var addBlockContract = web3.eth.contract([{
			"constant": true,
			"inputs": [
				{
				"name": "key",
				"type": "uint256"
				}
			],
			"name": "getID",
			"outputs": [
				{
				"name": "",
				"type": "uint256"
				}
			],
			"payable": false,
			"stateMutability": "view",
			"type": "function"
			},
			{
			"constant": true,
			"inputs": [
				{
				"name": "key",
				"type": "uint256"
				}
			],
			"name": "getAge",
			"outputs": [
				{
				"name": "",
				"type": "uint256"
				}
			],
			"payable": false,
			"stateMutability": "view",
			"type": "function"
			},
			{
			"constant": false,
			"inputs": [
				{
				"name": "data",
				"type": "bytes32"
				},
				{
				"name": "uage",
				"type": "uint8"
				},
				{
				"name": "uid",
				"type": "uint256"
				}
			],
			"name": "addData",
			"outputs": [],
			"payable": true,
			"stateMutability": "payable",
			"type": "function"
			},
			{
			"constant": true,
			"inputs": [
				{
				"name": "key",
				"type": "uint256"
				}
			],
			"name": "getName",
			"outputs": [
				{
				"name": "",
				"type": "bytes32"
				}
			],
			"payable": false,
			"stateMutability": "view",
			"type": "function"
			},
			{
			"constant": true,
			"inputs": [
				{
				"name": "",
				"type": "uint256"
				}
			],
			"name": "blockchain",
			"outputs": [
				{
				"name": "age",
				"type": "uint8"
				},
				{
				"name": "id",
				"type": "uint256"
				},
				{
				"name": "name",
				"type": "bytes32"
				}
			],
			"payable": false,
			"stateMutability": "view",
			"type": "function"
			}]);
		var view = addBlockContract.at('0x76908c7e27d2ab126e1fc9dfb037feafbb1fa9f1'); // contract instance to work with
		
		var idTest = document.getElementById('idTest');
		var ageTest = document.getElementById('ageTest');
		var nameTest = document.getElementById('nameTest');
		var button1 = document.getElementById('button1');
		var button2 = document.getElementById('button2');
		var button3 = document.getElementById('button3');
		var nextsearch = 0;
		//click handler - searching by name
		button1.addEventListener('click', function() {
			//if no name was entered into the search field, then let the user know and exit the function
			if(nameTest.value.length == 0) {
				alert("No input received. Please enter your information and try again.");
				return;
			}
			//clearing old blocks before executing search
			var x;
			for(x = 0; x <= nextsearch; x++) {
				$("#name" + x).empty();
				$("#id" + x).empty();
				$("#age" + x).empty();
			}
			//clear out all the data displayed in the blocks from the previous search and remove the blocks except for the first one
			for(x = 1; x <= nextsearch; x++) {
				$("#duplicater" + x).remove();
				$("#name" + x).empty();
				$("#id" + x).empty();
				$("#age" + x).empty();
				console.log("Removed old blocks");
				
			}
			console.log("RES:" + nameTest.value);
			key = 1;
			var ID = [];
			var age = [];
			var name1 = [];
			var blockcount = 0;
			nextsearch = 0;

			
			
			function addID(key, test){
				view.getID(key, function(worked, result){
					ID.push(result.c["0"]);
				});
				viewingBlockAge(key, test);
			}
			function viewingBlockID(key, test) {	
				view.getID(key, function(worked, result){
					if(result.c["0"]){
						viewingBlockName(key, test);
					}else{
						console.log("All keys found");
						if(ID.length == 0) {
									alert("No blocks found matching your search criteria.");
								}
						//TODO: call method that will draw blocks for user here!!!
						var i;
						
						for(i = 0; i< ID.length; i++) {

								
							
								newBlock(ID[i], age[i], name1[i]);
								blockcount++;
								duplicate();
						}
						return;

						
					}
				})
			}
			function viewingBlockAge(key, test) {
				view.getAge(key, function(worked, result){
						console.log(result.c["0"]);
						age.push(result.c["0"]);
						})
			}
			function viewingBlockName(key, test) {
				view.getName(key, function(worked, result){
					console.log(test)
						if(removeSpecialChars(web3.toAscii(result)) == test){
							name1.push(web3.toAscii(result));
							addID(key, test);
							viewingBlockAge(key, test)
						}
						viewingBlockID(key + 1, test);
						})
						
			}
				viewingBlockID(key, nameTest.value);
		})
		//click handler - searching by ID
		button2.addEventListener('click', function() {
			if(idTest.value.length == 0) {
				alert("No input received. Please enter your information and try again.");
				return;
			}
			//clearing old blocks before executing search
			var x;
			for(x = 0; x <= nextsearch; x++) {
				$("#name" + x).empty();
				$("#id" + x).empty();
				$("#age" + x).empty();
			}
			for(x = 1; x <= nextsearch; x++) {
				$("#duplicater" + x).remove();
				$("#name" + x).empty();
				$("#id" + x).empty();
				$("#age" + x).empty();
				console.log("Removed old blocks");
				
			}
			console.log("RES:" + idTest.value);
				key = 1;
				var ID = [];
				var age = [];
				var name1 = [];
				nextsearch = 0;
				function viewingBlockID(key, test) {	
					view.getID(key, function(worked, result){

						if(result.c["0"]){
							console.log((result.c["0"]));
							if (test == Number(result.c["0"])){
								console.log("HERE");
							ID.push(result.c["0"]);
							viewingBlockAge(key, test);
							viewingBlockName(key, test);

							}
							
							viewingBlockID(key + 1, Number(test));
						}else{
							console.log("All keys found");
							if(ID.length == 0) {
									alert("No blocks found matching your search criteria.");
								}
							//TODO: call method that will draw blocks for user here!!!
							var i;
							for(i = 0; i< ID.length; i++) {
									newBlock(ID[i], age[i], name1[i]);
									duplicate();
							}
							return;
						}
					})
				}
				function viewingBlockAge(key, test) {
					view.getAge(key, function(worked, result){
							console.log(result.c["0"]);
							age.push(result.c["0"]);
							})
				}
				function viewingBlockName(key, test) {
					view.getName(key, function(worked, result){
							console.log(result);
							console.log(result);
							name1.push(web3.toAscii(result));
							})
				}
				viewingBlockID(key, Number(idTest.value));
		})

			//click handler - searching by age
			button3.addEventListener('click', function() {
				if(ageTest.value.length == 0) {
					alert("No input received. Please enter your information and try again.");
				return;
				}
			//clearing old blocks before executing search
			var x;
			for(x = 0; x <= nextsearch; x++) {
				$("#name" + x).empty();
				$("#id" + x).empty();
				$("#age" + x).empty();
			}
			for(x = 1; x <= nextsearch; x++) {
				$("#duplicater" + x).remove();
				$("#name" + x).empty();
				$("#id" + x).empty();
				$("#age" + x).empty();
				console.log("Removed old blocks");
				
			}
			console.log("RES:" + ageTest.value);
				key = 1;
				var ID = [];
				var age = [];
				var name1 = [];
				nextsearch = 0;
				function addID(key, test){
				view.getID(key, function(worked, result){
					ID.push(result.c["0"]);
				});
			}
				function viewingBlockID(key, test) {	
					view.getID(key, function(worked, result){
						if(result.c["0"]){

							
							viewingBlockAge(key, test);

							
						}else{
							console.log("All keys found");
							if(ID.length == 0) {
									alert("No blocks found matching your search criteria.");
								}
							//TODO: call method that will draw blocks for user here!!!
							var i;
							for(i = 0; i< ID.length; i++) {
									newBlock(ID[i], age[i], name1[i]);
									duplicate();
							}
							return;
						}
					})
				}
				function viewingBlockAge(key, test) {
					view.getAge(key, function(worked, result){
							if(result.c["0"] == test){
								age.push(result.c["0"]);
								viewingBlockName(key, test);
								addID(key, test);
							}
							})
							viewingBlockID(key+1, test);
				}
				function viewingBlockName(key, test) {
					view.getName(key, function(worked, result){

							console.log(result);

							console.log(result);
							name1.push(web3.toAscii(result));
							})
				}
				viewingBlockAge(key, Number(ageTest.value));
		})
		
	var difficulty = document.getElementById("name");
	var extraData  = document.getElementById("id");
	var gasLimit = document.getElementById("age");

	//function to create a new block object to be displayed on page
	
	function newBlock(id, age, name) {
		$('#name' + nextsearch).text(removeSpecialChars(name)); 
		$('#id'+ nextsearch).text(id); 
		$('#age'+ nextsearch).text(age); 		
	}
	
	function duplicate() {
		var original = document.getElementById('duplicater' + nextsearch);
		var clone = original.cloneNode(true); // "deep" clone
		clone.id = "duplicater" + ++nextsearch; // there can only be one element with an ID
	
		//update IDs of children pre fields
		clone.getElementsByTagName('pre')[0].id = "name" + nextsearch;
		clone.getElementsByTagName('pre')[1].id = "id" + nextsearch;
		clone.getElementsByTagName('pre')[2].id = "age" + nextsearch;

		original.parentNode.appendChild(clone); // appends child div to previous parent div
		$('[data-toggle="tooltip"]').tooltip();  //duplicate all tooltips
	}

	
</script>


<script>

	var output2 = document.getElementById('output2');
	var printThis = "";
function button(evt, tab){
	
	var i, x, tablinks;
	x = document.getElementsByClassName("tab");
	for (i = 0; i < x.length; i++) {
     		x[i].style.display = "none";
  	}
  	tablinks = document.getElementsByClassName("tablink");
  	for (i = 0; i < x.length; i++) {
      		tablinks[i].className = tablinks[i].className.replace("", ""); 
  	}
  	document.getElementById(tab).style.display = "block";
  	
}
</script>

<!-- Javascript Block Creation for Viewing Blocks on Chain -->
<script>
	



</script>

</body>
</html>
